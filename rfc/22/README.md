---
domain: github.com
shortname: 22/MPAUX
name: Multipool Auxiliary Layout Parameters Generation
status: raw
editors: Suvrat Joshi <suvrat.joshi@seagate.com>
---

## Language

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC 2119](https://tools.ietf.org/html/rfc2119).

## Abstract

The multipools feature gives cluster an ability to have multiple pools (sets) of the disk/storage resources and IO's can be done on the desired pool.
The auxiliary pools feature is required for creating auxialiry pool sets, one of which could be used upon failure of one or more disk resources.

### Design

If some disk resources in a cluster fail for some reason temporarily (because of reasons like reboot or transient network error etc.), then it is expected that cluster still works properly with reduced pool layout for failure handling. Let's say the initial pool layout configuration is 4+2, and a storage set has 6 data volumes. If 1-2 of those data volumes fail, the pool is switched to 2+2 layout on the remaining data volumes. There can be several combinations of the 2+2 data volume layouts, depending on which particular two volumes fail. All such combinations need to be pre-populated (auto-generated by Hare from the CDF configuration) by the hctl bootstrap script.

## Details with example
Each storage set corresponds to a standalone Motr pool. For the sake of practicality, this description will assume a default storage set configuration, which consists of six nodes, srvnode-1..6 (three enclosures, each has two controllers). Where every storage set pool has 4+2 layout, which means â€” four data units(N) and two parity units(K) in a parity group.
Typical configuration of such pool in the CDF format, expected by [`cfgen`](rfc/18/README.md), would be something like this:
```yaml
pools:
  - name: pool4
    disk_refs:
      - { path: /dev/sdb, node: ssc-vm-3180.colo.seagate.com }
      - { path: /dev/sdb, node: ssc-vm-3181.colo.seagate.com }
      - { path: /dev/sdb, node: ssc-vm-2492.colo.seagate.com }
      - { path: /dev/sdb, node: ssc-vm-2493.colo.seagate.com }
      - { path: /dev/sdb, node: ssc-vm-2494.colo.seagate.com }
      - { path: /dev/sdb, node: ssc-vm-2495.colo.seagate.com }
    data_units: 4
    parity_units: 2
    allowed_failures: { site: 0, rack: 0, encl: 0, ctrl: 0, disk: 1 }
profiles:
  - name: six_node
    pools: [ pool6 ]
```


